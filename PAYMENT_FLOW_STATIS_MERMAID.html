<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Flow - Sistem Statis Manual</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
            background: #fafafa;
        }
        .header {
            text-align: center;
            padding: 25px;
            background: #ffe0b2;
            border-bottom: 2px solid #333;
            margin-bottom: 25px;
        }
        .header h1 {
            margin: 0;
            font-size: 24px;
        }
        .header p {
            margin: 5px 0 0 0;
            font-size: 14px;
            color: #555;
        }
        .section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
        }
        .section h2 {
            font-size: 18px;
            margin: 0 0 15px 0;
            border-bottom: 1px solid #ccc;
            padding-bottom: 8px;
        }
        .info {
            background: #fafafa;
            padding: 12px;
            border-left: 3px solid #666;
            margin: 12px 0;
            font-size: 13px;
        }
        .warning {
            background: #fff3cd;
            padding: 12px;
            border-left: 3px solid #ff9800;
            margin: 12px 0;
            font-size: 13px;
        }
        .mermaid {
            padding: 15px;
            background: #fff;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Payment Flow - Sistem Statis Manual</h1>
        <p>Alur pembayaran dengan bank transfer manual</p>
    </div>

    <div class="warning">
        Sistem ini memerlukan admin untuk manual verify setiap transaksi dengan check rekening bank. Tidak direkomendasikan untuk production.
    </div>

    <div class="section">
        <h2>1. Arsitektur Sistem</h2>
        <div class="info">Sistem menggunakan bank transfer manual. Harga hardcoded, nomor VA tetap untuk semua user, dan admin harus verify setiap transaksi.</div>
        <div class="mermaid">
graph TB
    TG["üë§ Telegram User"]
    MA["üì± Mini App"]
    API["üîß FastAPI Backend"]
    ADMIN["üë®‚Äçüíº Admin"]
    BANK["üè¶ Bank Account"]
    DB["üìä Database"]
    BOT["ü§ñ Bot"]
    
    TG --> MA
    MA --> API
    API --> DB
    
    TG --> BANK
    BANK --> ADMIN
    ADMIN --> API
    API --> BOT
    BOT --> TG
    
    style TG fill:#ffe0b2
    style MA fill:#ffccbc
    style API fill:#ffb74d
    style ADMIN fill:#ff9800,color:#fff
    style BANK fill:#ffa726
    style DB fill:#ffd54f
    style BOT fill:#ffe082
        </div>
    </div>

    <div class="section">
        <h2>2. Payment Flow - Step by Step</h2>
        <div class="info">Dari user memilih paket sampai admin verifikasi manual.</div>
        <div class="mermaid">
sequenceDiagram
    participant User
    participant App as Mini App
    participant Backend as FastAPI
    participant Bank as Bank
    participant Admin as Admin
    
    User->>App: Pilih paket
    App->>Backend: POST /create-payment
    Backend->>Backend: Get hardcoded price & VA
    Backend->>App: Return VA number
    App->>User: Show payment info
    
    User->>Bank: Transfer ke VA
    
    Note over Admin: Manual check...
    
    Admin->>Bank: Check rekening
    Bank-->>Admin: Confirm transfer?
    Admin->>Admin: Match invoice?
    
    alt Verified ‚úÖ
        Admin->>Backend: Approve payment
        Backend->>Backend: Update status
    else Reject ‚ùå
        Admin->>User: Rejected
    end
        </div>
    </div>

    <div class="section">
        <h2>3. Database State</h2>
        <div class="info">Update database tergantung admin verification.</div>
        <div class="mermaid">
graph LR
    A["1. Create<br/>status: pending<br/>VA: hardcoded"] --> B["2. User<br/>transfer"]
    B --> C["3. Admin<br/>check manual"]
    C --> D["4. Admin<br/>verify"]
    D --> E["5. Update<br/>VIP"]
    E --> F["6. Notify"]
    
    style A fill:#fff9c4
    style B fill:#bbdefb
    style C fill:#ffccbc
    style D fill:#ffccbc
    style E fill:#c8e6c9
    style F fill:#c8e6c9
        </div>
    </div>

    <div class="section">
        <h2>4. Status Flow</h2>
        <div class="mermaid">
stateDiagram-v2
    [*] --> pending
    pending --> awaiting_admin
    awaiting_admin --> verified
    awaiting_admin --> rejected
    verified --> success
    rejected --> pending
    success --> [*]
        </div>
    </div>

    <div class="section">
        <h2>5. Admin Verification Process</h2>
        <div class="info">Step-by-step apa yang harus dilakukan admin.</div>
        <div class="mermaid">
graph TD
    A["Admin login<br/>to dashboard"]
    B["View pending<br/>payments list"]
    C["Go to<br/>online banking"]
    D["Check account<br/>statements"]
    E{"Transfer<br/>ada?"}
    F["Amount<br/>match?"]
    G["Ref/memo<br/>match?"]
    H["‚úÖ Approve<br/>in panel"]
    I["‚ùå Mark<br/>reject"]
    
    A --> B
    B --> C
    C --> D
    D --> E
    E -->|No| I
    E -->|Yes| F
    F -->|No| I
    F -->|Yes| G
    G -->|No| I
    G -->|Yes| H
    
    style A fill:#fff9c4
    style H fill:#c8e6c9
    style I fill:#ffcdd2
        </div>
    </div>

    <div class="section">
        <h2>Karakteristik Sistem Statis:</h2>
        <ul style="margin: 0; padding-left: 20px; line-height: 1.8; font-size: 14px;">
            <li>Harga hardcoded di database (tidak fleksibel)</li>
            <li>Nomor VA sama untuk semua user</li>
            <li>Admin harus manual check bank setiap transaksi</li>
            <li>Admin harus manual approve di dashboard</li>
            <li>Aktivasi VIP lambat (tergantung admin)</li>
            <li>Tidak scalable (beban admin bertambah)</li>
            <li>Rawan fraud (VA sama semua)</li>
            <li>Rentan kesalahan manual</li>
        </ul>
    </div>

    <div class="section">
        <h2>Perbandingan Singkat:</h2>
        <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
            <tr style="background: #f0f0f0;">
                <td style="padding: 10px; border: 1px solid #ddd;"><b>Aspek</b></td>
                <td style="padding: 10px; border: 1px solid #ddd;"><b>Statis</b></td>
                <td style="padding: 10px; border: 1px solid #ddd;"><b>Dinamis</b></td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">Gateway</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Manual bank</td>
                <td style="padding: 10px; border: 1px solid #ddd;">DOKU API</td>
            </tr>
            <tr style="background: #fafafa;">
                <td style="padding: 10px; border: 1px solid #ddd;">Verifikasi</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Admin manual</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Automatic</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">Harga</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Hardcoded</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Fleksibel</td>
            </tr>
            <tr style="background: #fafafa;">
                <td style="padding: 10px; border: 1px solid #ddd;">Aktivasi</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Lambat</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Instant</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">Security</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Rendah</td>
                <td style="padding: 10px; border: 1px solid #ddd;">HMAC verify</td>
            </tr>
        </table>
    </div>

</body>
</html>